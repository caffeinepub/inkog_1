{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 17,
  "summary": "Inkog: an anonymous school reporting web platform with three role-based interfaces (student submission without login, staff dashboards per school, and owner/admin management) built with HTML/CSS/JS frontend and Firebase (Auth, Firestore, Hosting) backend, emphasizing privacy, dark-mode modern UI, and mobile responsiveness.",
  "architectural_notes": [
    "Tech stack set to vanilla HTML/CSS/JavaScript frontend with Firebase Authentication, Firestore, and Hosting backend.",
    "Role separation: Student (no auth), Staff/Counsellor (email/password auth, school-scoped access), Owner/Admin (full access).",
    "Privacy requirement: do not store any identifying information (name/email/phone) or IP addresses with reports; reports display timestamp only to staff.",
    "Firestore must enforce per-school access controls so staff can only read/update reports for their own school.",
    "Admin access bootstrapping needed: canister must assign an initial admin principal on init (or allow first caller to become admin if no admin exists) so isCallerAdmin() can pass.",
    "Admin bootstrapping depends on a backend AccessControl/authorization module; if the module is missing or not wired into the canister, isAdmin(...) will always fail and no one can access the Admin page.",
    "Decision confirmed: create `backend/authorization/` folder and implement the missing Motoko modules `access-control.mo` and `MixinAuthorization.mo` referenced by `backend/main.mo` so admin checks/authorization can function."
  ],
  "known_issues": [
    "Admin page access denied because no initial admin principal is assigned in the backend; isCallerAdmin() always fails until an admin is manually added.",
    "Admin bootstrapping/authorization logic is missing from the backend (e.g., expected authorization/access-control.mo module not present or not connected), causing all callers to be treated as non-admins and blocking Admin page access.",
    "Deployment/build did not complete successfully (deployment error encountered); user requested a retry of deployment.",
    "After the latest attempted deployment/build, the user reports it is still \"not working\" (problem persists; likely admin access still denied and/or deployment/build not actually successful).",
    "Admin page currently shows immediate \"Access denied\" when user opens it (no loading/spinner)."
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-implement-a-public-student-interface-that-allows-anyone-to-submit-a-report-without-logging-in-using-a-large-free-text-input-an-optional-category-selector-bullying-harassment-mental-health-suggestion-other-a-submit-button-and-a-post-submit-confirmation-message-exactly-your-report-has-been-submitted-anonymously",
      "title": "Implement a public Student interface that allows anyone to submit a report without logging in, using a large free-text input, an optional category selector (Bullying, Harassment, Mental Health, Suggestion, Other), a submit button, and a post-submit confirmation message exactly: “Your report has been submitted anonymously”.",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-enforce-privacy-guarantees-for-student-submissions-do-not-collect-or-store-name-email-phone-number-or-ip-address-and-do-not-log-or-persist-any-network-identifying-metadata-beyond-what-is-required-by-the-internet-computer-platform-runtime-no-app-level-ip-capture",
      "title": "Enforce privacy guarantees for student submissions: do not collect or store name, email, phone number, or IP address; and do not log or persist any network-identifying metadata beyond what is required by the Internet Computer platform runtime (no app-level IP capture).",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-a-school-staff-counsellor-interface-with-secure-login-and-authorization-where-staff-can-only-access-reports-for-their-own-school",
      "title": "Implement a School Staff/Counsellor interface with secure login and authorization, where staff can only access reports for their own school.",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-provide-a-staff-dashboard-to-view-submitted-reports-for-that-staff-member-s-school-with-filters-by-category-and-date-range-showing-each-report-with-timestamp-only-no-identity-and-allowing-staff-to-mark-reports-as-reviewed-or-resolved",
      "title": "Provide a Staff dashboard to view submitted reports for that staff member’s school, with filters by category and date range, showing each report with timestamp only (no identity), and allowing staff to mark reports as “Reviewed” or “Resolved”.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-an-owner-admin-interface-with-full-administrative-access-to-add-edit-remove-schools-create-staff-counsellor-accounts-for-each-school-view-number-of-reports-per-school-and-manage-platform-settings",
      "title": "Implement an Owner/Admin interface with full administrative access to: add/edit/remove schools; create staff/counsellor accounts for each school; view number of reports per school; and manage platform settings.",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-clear-separation-of-roles-and-navigation-student-anonymous-no-login-staff-authenticated-school-scoped-and-owner-admin-authenticated-global-ensure-routes-pages-are-not-interchangeable-and-are-protected-by-backend-authorization-not-just-frontend-checks",
      "title": "Implement clear separation of roles and navigation: student (anonymous, no login), staff (authenticated, school-scoped), and owner/admin (authenticated, global). Ensure routes/pages are not interchangeable and are protected by backend authorization (not just frontend checks).",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    },
    {
      "id": "feature-create-a-clean-modern-mobile-friendly-ui-with-dark-mode-preferred-and-apply-a-coherent-visual-theme-consistently-across-student-staff-and-admin-interfaces-choose-a-distinct-style-appropriate-for-a-privacy-safety-trust-product-avoid-blue-purple-by-default",
      "title": "Create a clean, modern, mobile-friendly UI with dark mode preferred, and apply a coherent visual theme consistently across student, staff, and admin interfaces. Choose a distinct style appropriate for a privacy/safety/trust product (avoid blue/purple by default).",
      "reqIds": [
        "REQ-8"
      ],
      "version": 1
    },
    {
      "id": "feature-provide-setup-and-deployment-instructions-tailored-to-the-internet-computer-template-motoko-backend-react-typescript-frontend-including-local-development-steps-canister-deployment-steps-and-how-to-initialize-the-first-admin-owner-access-securely",
      "title": "Provide setup and deployment instructions tailored to the Internet Computer template (Motoko backend + React/TypeScript frontend), including local development steps, canister deployment steps, and how to initialize the first admin/owner access securely.",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-setup-deployment-documentation-to-explain-how-the-initial-admin-is-established-under-the-new-bootstrapping-behavior-including-clear-steps-for-first-time-login-to-claim-admin-access-and-what-to-do-if-an-admin-already-exists",
      "title": "Update the setup/deployment documentation to explain how the initial admin is established under the new bootstrapping behavior, including clear steps for first-time login to claim admin access and what to do if an admin already exists.",
      "reqIds": [
        "REQ-11"
      ],
      "version": 1
    },
    {
      "id": "feature-improve-frontend-error-handling-for-admin-staff-auth-checks-so-that-if-backend-auth-queries-fail-e-g-due-to-a-trap-or-actor-initialization-problem-the-ui-shows-a-clear-english-error-state-with-a-retry-option-rather-than-silently-failing-or-leaving-the-user-blocked-on-a-spinner",
      "title": "Improve frontend error handling for admin/staff auth checks so that if backend auth queries fail (e.g., due to a trap or actor initialization problem), the UI shows a clear English error state with a retry option rather than silently failing or leaving the user blocked on a spinner.",
      "reqIds": [
        "REQ-31"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-setup-deployment-documentation-to-include-a-focused-english-troubleshooting-section-for-the-current-failure-mode-admin-access-not-working-including-how-to-deploy-successfully-how-to-perform-first-admin-bootstrapping-and-how-to-verify-post-deploy-checks-student-can-submit-staff-denied-without-account-admin-bootstraps-on-first-login",
      "title": "Update the setup/deployment documentation to include a focused English troubleshooting section for the current failure mode (“admin access not working”), including: how to deploy successfully, how to perform first-admin bootstrapping, and how to verify post-deploy checks (student can submit, staff denied without account, admin bootstraps on first login).",
      "reqIds": [
        "REQ-32"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Student interface: anonymous report submission (no login) with text box, optional category selector, submit + confirmation message, and privacy guarantee (no personal data stored).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Staff/counsellor interface: secure email+password login, scoped to own school, dashboard listing reports with timestamp only, filters (category/date), and status updates (Reviewed/Resolved).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Owner/admin interface: manage schools (add/edit/remove), create staff accounts per school, view report counts per school, and manage platform settings.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "UI requirements: clean modern design with dark mode preferred and mobile-friendly responsive layout; clear separation of student/staff/admin experiences.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-5",
      "summary": "Firebase backend implementation: Auth for staff/admin, Firestore schema for schools/staff/reports/status, and Hosting deployment; include complete working code and setup instructions.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "Privacy/safety requirements: ensure student reports are anonymous and do not store identity fields (name/email/phone) or IP addresses; enforce role-based access controls to prevent cross-school access.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-13",
      "summary": "Define and implement a backend data model and APIs to support: schools, staff accounts mapped to a school, admin identities, reports (with category, text, timestamp, status), and platform settings. Data must persist across canister upgrades per standard stable-state practices.",
      "reqIds": [
        "REQ-7"
      ],
      "status": "pending"
    },
    {
      "id": "AR-14",
      "summary": "Implement admin bootstrapping so that the first authenticated caller can access the Admin page when no admin principal exists yet. Specifically: when the canister has zero admins configured, the first Internet Identity principal that triggers the admin check must be automatically granted admin privileges (and any required base user permission), after which all subsequent non-admin callers must continue to be denied admin access unless explicitly granted admin rights.",
      "reqIds": [
        "REQ-10"
      ],
      "status": "pending"
    },
    {
      "id": "AR-15",
      "summary": "Add the missing backend authorization modules referenced by `backend/main.mo` (`authorization/access-control` and `authorization/MixinAuthorization`) so the canister compiles and role checks (admin/user) work end-to-end.",
      "reqIds": [
        "REQ-12"
      ],
      "status": "pending"
    },
    {
      "id": "AR-16",
      "summary": "Implement admin bootstrapping in the backend so that when there are zero admins configured, the first authenticated Internet Identity principal that triggers the admin check is automatically granted admin privileges (and any required base permission), after which subsequent non-admin callers remain denied unless explicitly granted admin access.",
      "reqIds": [
        "REQ-13"
      ],
      "status": "pending"
    },
    {
      "id": "AR-17",
      "summary": "Ensure the access-control state (including the admin list/roles) persists across canister upgrades so that a previously bootstrapped admin does not lose access after redeploying/upgrading.",
      "reqIds": [
        "REQ-14"
      ],
      "status": "pending"
    },
    {
      "id": "AR-18",
      "summary": "Resolve the current deployment failure by fixing the backend compilation/build blockers so `dfx deploy` can complete successfully.",
      "reqIds": [
        "REQ-15"
      ],
      "status": "pending"
    },
    {
      "id": "AR-19",
      "summary": "Implement admin bootstrapping in the Motoko backend so that when there are zero admins configured, the first authenticated Internet Identity principal that triggers an admin check is automatically granted admin privileges (and any required base user permission), and subsequent non-admin callers remain denied unless explicitly granted.",
      "reqIds": [
        "REQ-16"
      ],
      "status": "pending"
    },
    {
      "id": "AR-20",
      "summary": "Ensure authorization/admin state and core application data persists across canister upgrades (redeploy/upgrade) using stable storage, and add/adjust `backend/migration.mo` only if required by the existing state upgrade path.",
      "reqIds": [
        "REQ-17"
      ],
      "status": "pending"
    },
    {
      "id": "AR-21",
      "summary": "Update the deployment documentation to include clear steps to retry deployment and verify success (build, deploy, and basic post-deploy checks for student submission, staff access denial without staff account, and admin bootstrapping flow). Use English for all user-facing text.",
      "reqIds": [
        "REQ-18"
      ],
      "status": "pending"
    },
    {
      "id": "AR-22",
      "summary": "Add the missing Motoko authorization modules that `backend/main.mo` imports (`authorization/access-control.mo` and `authorization/MixinAuthorization.mo`) so the backend can compile and role/permission checks work end-to-end.",
      "reqIds": [
        "REQ-19"
      ],
      "status": "pending"
    },
    {
      "id": "AR-23",
      "summary": "Implement correct admin bootstrapping behavior in the authorization layer: when there are zero admins configured, the first authenticated Internet Identity principal that triggers an admin check must be automatically granted admin privileges (and any required base permission), after which subsequent non-admin callers remain denied unless explicitly granted admin rights.",
      "reqIds": [
        "REQ-20"
      ],
      "status": "pending"
    },
    {
      "id": "AR-24",
      "summary": "Expose a backend API used by the frontend to check admin status (`isCallerAdmin()`), implemented via the authorization mixin/module, and ensure it is consistent with the bootstrapping and admin list behavior.",
      "reqIds": [
        "REQ-21"
      ],
      "status": "pending"
    },
    {
      "id": "AR-25",
      "summary": "Ensure authorization state (at least: admin list / roles / permissions needed for `isAdmin` and `hasPermission`) persists across canister upgrades so a previously bootstrapped admin does not lose access after redeploying/upgrading.",
      "reqIds": [
        "REQ-22"
      ],
      "status": "pending"
    },
    {
      "id": "AR-26",
      "summary": "Update the deployment/setup documentation to include clear English steps to validate the authorization fix: deploy successfully, perform first-admin bootstrapping login, and verify that the Admin page becomes accessible for the bootstrapped principal.",
      "reqIds": [
        "REQ-23"
      ],
      "status": "pending"
    },
    {
      "id": "AR-27",
      "summary": "Create the missing Motoko authorization folder and modules so that `backend/main.mo` can import them successfully: add `backend/authorization/access-control.mo` and `backend/authorization/MixinAuthorization.mo` matching these imports exactly: `import AccessControl \"authorization/access-control\";` and `import MixinAuthorization \"authorization/MixinAuthorization\";`.",
      "reqIds": [
        "REQ-24"
      ],
      "status": "pending"
    },
    {
      "id": "AR-28",
      "summary": "Implement the AccessControl API expected by `backend/main.mo` in `backend/authorization/access-control.mo`, including: `initState()`, `isAdmin(state, principal)`, `hasPermission(state, principal, permissionVariant)`, and `assignRole(state, caller, targetPrincipal, roleVariant)` with role/permission variants that at least support `#admin` and `#user` used by `backend/main.mo`.",
      "reqIds": [
        "REQ-25"
      ],
      "status": "pending"
    },
    {
      "id": "AR-29",
      "summary": "Implement `backend/authorization/MixinAuthorization.mo` as an includable mixin compatible with `include MixinAuthorization(accessControlState);` in `backend/main.mo`, and ensure it exposes a canister method `public query ({ caller }) func isCallerAdmin() : async Bool` that returns the admin status for the caller based on the shared `accessControlState`.",
      "reqIds": [
        "REQ-26"
      ],
      "status": "pending"
    },
    {
      "id": "AR-30",
      "summary": "Unblock backend compilation by adding the missing Motoko authorization modules imported by `backend/main.mo`: create `backend/authorization/access-control.mo` and `backend/authorization/MixinAuthorization.mo` so these imports resolve exactly: `import AccessControl \"authorization/access-control\";` and `import MixinAuthorization \"authorization/MixinAuthorization\";`.",
      "reqIds": [
        "REQ-27"
      ],
      "status": "pending"
    },
    {
      "id": "AR-31",
      "summary": "Implement correct admin bootstrapping in the backend authorization layer: when there are zero admins configured, the first authenticated Internet Identity principal who triggers the admin check must be automatically granted admin privileges (and any required base role/permission such as `#user`), and subsequent non-admin callers must continue to be denied admin access unless explicitly granted.",
      "reqIds": [
        "REQ-28"
      ],
      "status": "pending"
    },
    {
      "id": "AR-32",
      "summary": "Ensure the backend exposes the canister methods required by the existing frontend auth flow, matching the current frontend calls: implement `public query ({ caller }) func isCallerAdmin() : async Bool` and implement `public shared ({ caller }) func _initializeAccessControlWithSecret(secret : Text) : async ()` (called by `frontend/src/hooks/useActor.ts`). These must be implemented via the authorization mixin/module included by `backend/main.mo` and must be consistent with admin bootstrapping behavior.",
      "reqIds": [
        "REQ-29"
      ],
      "status": "pending"
    },
    {
      "id": "AR-33",
      "summary": "Persist authorization/admin state across canister upgrades so a previously bootstrapped admin does not lose access after redeploying/upgrading. Add/adjust `backend/migration.mo` only if required by the existing state upgrade path and the current project state.",
      "reqIds": [
        "REQ-30"
      ],
      "status": "pending"
    },
    {
      "id": "AR-34",
      "summary": "Unblock backend compilation by creating the missing Motoko authorization modules referenced by `backend/main.mo` so these imports resolve exactly: `import AccessControl \"authorization/access-control\";` and `import MixinAuthorization \"authorization/MixinAuthorization\";`.",
      "reqIds": [
        "REQ-33"
      ],
      "status": "pending"
    },
    {
      "id": "AR-35",
      "summary": "Implement the AccessControl API expected by `backend/main.mo` in `backend/authorization/access-control.mo`, including role/permission types and these functions: `initState()`, `isAdmin(state, principal)`, `hasPermission(state, principal, permissionVariant)`, and `assignRole(state, caller, targetPrincipal, roleVariant)`, with roles/permissions supporting at least `#admin` and `#user` as used by `backend/main.mo`.",
      "reqIds": [
        "REQ-34"
      ],
      "status": "pending"
    },
    {
      "id": "AR-36",
      "summary": "Implement `backend/authorization/MixinAuthorization.mo` as an includable mixin compatible with `include MixinAuthorization(accessControlState);` in `backend/main.mo`, and ensure it exposes canister methods required by the existing frontend auth flow: `public query ({ caller }) func isCallerAdmin() : async Bool` and `public shared ({ caller }) func _initializeAccessControlWithSecret(secret : Text) : async ()`.",
      "reqIds": [
        "REQ-35"
      ],
      "status": "pending"
    },
    {
      "id": "AR-37",
      "summary": "Fix the 'Admin page shows immediate Access Denied' issue by implementing correct admin bootstrapping behavior in the backend authorization layer: when there are zero admins configured, the first authenticated Internet Identity principal that triggers authorization initialization/check must be automatically granted admin privileges (and any required base role such as `#user`), and subsequent non-admin callers must remain denied unless explicitly granted admin rights.",
      "reqIds": [
        "REQ-36"
      ],
      "status": "pending"
    },
    {
      "id": "AR-38",
      "summary": "Ensure authorization state persists across canister upgrades so a previously bootstrapped admin does not lose access after redeploying/upgrading, using the existing stable storage pattern in `backend/main.mo` (`stableUserRoles` and `preupgrade`/`postupgrade`). Add or adjust `backend/migration.mo` only if required by the existing state upgrade path.",
      "reqIds": [
        "REQ-37"
      ],
      "status": "pending"
    },
    {
      "id": "AR-39",
      "summary": "Validate end-to-end admin gating behavior in the frontend without modifying immutable hook files: after the backend fix, an authenticated bootstrapped admin can access `AdminDashboardPage`, while non-admin authenticated users remain blocked by `AccessDeniedScreen` with the existing English text 'Access Denied'.",
      "reqIds": [
        "REQ-38"
      ],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "Inkog",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}